machine:
  services:
    - docker
  post:
    - eval `aws ecr get-login`

dependencies:
  # cache_directories:
  #   - ~/docker

  override:
    - ./.docker/build.sh

deployment:
  hub:
    branch: features/docker
    commands:
      - ./.docker/push.sh
      - ./.docker/publish.sh

test:
  override:
    - RAILS_ENV=test bundle exec rspec -r rspec_junit_formatter --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
