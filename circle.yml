machine:
  services:
    - docker
  post:
    - eval `aws ecr get-login`

dependencies:
  cache_directories:
    - ~/docker

  override:
    - ./.docker/build

deployment:
  hub:
    branch: features/docker
    commands:
      - ./.docker/push
      - ./.docker/publish

test:
  override:
    - RAILS_ENV=test bundle exec rspec -r rspec_junit_formatter --format RspecJunitFormatter -o $CIRCLE_TEST_REPORTS/rspec/junit.xml
